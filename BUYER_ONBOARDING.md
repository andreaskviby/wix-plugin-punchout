# Buyer Onboarding Guide - B2B PunchOut Connector

## Overview
This guide helps enterprise buyers integrate with your Wix store through PunchOut protocols (cXML and OCI).

## Supported Procurement Systems
- **Coupa** (cXML)
- **SAP Ariba** (cXML) 
- **JAGGAER** (cXML)
- **SAP SRM/ERP** (OCI)
- Any cXML 1.2+ or OCI compatible system

---

## Quick Setup Checklist

### For Buyers
- [ ] Provide supplier with your procurement system details
- [ ] Share authentication credentials (domains, shared secrets)
- [ ] Define catalog scope and pricing agreements
- [ ] Test PunchOut connection before go-live
- [ ] Configure your procurement system catalog entry

### For Suppliers
- [ ] Create buyer configuration in admin dashboard
- [ ] Configure pricing and catalog scope
- [ ] Set up field mappings for your catalog
- [ ] Test connection with buyer
- [ ] Provide buyer with endpoint URLs

---

## Coupa Integration

### Buyer Setup in Coupa

1. **Navigate to Coupa Admin**
   - Go to Setup → Suppliers → [Your Supplier]
   - Click "Catalogs" tab

2. **Add PunchOut Catalog**
   - Click "Add Catalog"
   - Select "PunchOut" as catalog type
   - Enter catalog details:
     - **Name**: Your Company PunchOut Catalog
     - **Description**: Direct access to supplier catalog
     - **Currency**: USD (or your preferred currency)

3. **Configure PunchOut Settings**
   ```
   Setup URL: https://yourstore.wix.com/_functions/punchout/cxml/setup
   Authentication: cXML Shared Secret
   From Domain: buyer.coupa.com
   From Identity: [Your Coupa Identity]
   To Domain: yourstore.wix.com  
   To Identity: [Your Supplier Identity]
   Shared Secret: [Generated by supplier]
   ```

4. **Test Connection**
   - Click "Test PunchOut" in Coupa
   - Verify you can browse supplier catalog
   - Add test items and return to Coupa
   - Check requisition is created correctly

### Supplier Configuration for Coupa

```javascript
// Example buyer configuration
{
  "buyerId": "coupa_acme_corp",
  "type": "cXML",
  "identities": {
    "from": "buyer.coupa.com",
    "to": "yourstore.wix.com",
    "sender": "buyer.coupa.com"
  },
  "sharedSecret": "stored-in-wix-secrets",
  "active": true,
  "priceListId": "coupa_pricing",
  "catalogScope": {
    "allowedCollections": ["b2b-products"],
    "excludedProducts": []
  },
  "fieldMappings": {
    "sku": "supplierPartId",
    "category": "unspscCode",
    "extrinsics": {
      "LeadTime": "leadTime",
      "Vendor": "vendor"
    }
  }
}
```

---

## SAP Ariba Integration

### Buyer Setup in Ariba

1. **Access Ariba Network**
   - Log into Ariba Network as buyer
   - Navigate to Trading Partner setup

2. **Add Supplier PunchOut**
   - Search for your supplier in Ariba Network
   - Request PunchOut catalog setup
   - Or configure manually:

3. **Manual PunchOut Configuration**
   ```
   Setup URL: https://yourstore.wix.com/_functions/punchout/cxml/setup
   From Domain: [buyer.ariba.com or custom]
   From Identity: [Buyer Identity in Ariba]  
   To Domain: yourstore.wix.com
   To Identity: [Your Supplier Identity]
   Shared Secret: [Shared with supplier]
   ```

4. **Catalog Publishing** 
   - Configure catalog in Ariba Buying
   - Set up approval workflows
   - Test end-to-end procurement

### Ariba-Specific Considerations
- Support for Ariba guided buying workflows
- Custom field mappings for Ariba taxonomies
- Multi-language support if required
- Currency conversion handling

---

## JAGGAER Integration

### Buyer Setup in JAGGAER

1. **Access JAGGAER Admin**
   - Navigate to Catalog Management
   - Select "External Catalogs"

2. **Create PunchOut Catalog**
   ```
   Catalog Name: [Your Company] PunchOut
   Type: PunchOut (cXML)
   Setup URL: https://yourstore.wix.com/_functions/punchout/cxml/setup
   Authentication Method: Shared Secret
   ```

3. **Configure Authentication**
   ```
   Buyer Domain: [your-org].jaggaer.com
   Buyer Identity: [buyer-identity]
   Supplier Domain: yourstore.wix.com
   Supplier Identity: [supplier-identity]  
   Shared Secret: [provided-by-supplier]
   ```

4. **Test Integration**
   - Use JAGGAER test harness
   - Verify shopping cart functionality
   - Test return to JAGGAER workflow

---

## SAP SRM/ERP (OCI) Integration

### Buyer Setup in SAP

1. **Configure OCI Catalog** (Transaction: SRM_SERVER)
   ```
   Catalog ID: SUPPLIER_PUNCHOUT
   Catalog Name: Your Company PunchOut
   Catalog URL: https://yourstore.wix.com/_functions/punchout/oci/start
   ```

2. **Set OCI Parameters**
   ```
   HOOK_URL: [Your SAP return URL]
   USERNAME: [SAP username]
   USEREMAIL: [user-email]
   CALLER: SRM
   VERSION: 4.0
   ```

3. **Configure Return Processing**
   - Set up return URL endpoint in SAP
   - Configure item field mappings
   - Test cart return processing

### OCI Field Mappings
```
NEW_ITEM-1-DESCRIPTION → Item Description
NEW_ITEM-1-MATNR → Material Number  
NEW_ITEM-1-QUANTITY → Quantity
NEW_ITEM-1-UNIT → Unit of Measure
NEW_ITEM-1-PRICE → Unit Price
NEW_ITEM-1-CURRENCY → Currency
NEW_ITEM-1-LEADTIME → Lead Time
NEW_ITEM-1-VENDOR → Vendor
```

### SAP-Specific Configuration
```javascript
// OCI buyer auto-created on first access
{
  "buyerId": "oci_sap_acme_com_john_doe",
  "type": "OCI", 
  "identities": {
    "hookUrl": "https://sap.acme.com/sap/bc/gui/sap/its/bbpfunds",
    "username": "john.doe",
    "domain": "sap.acme.com"
  },
  "active": true,
  "catalogScope": {
    "allowedCollections": ["sap-approved"]
  }
}
```

---

## Testing Procedures

### Pre-Go-Live Testing

#### 1. Connection Test
- Use procurement system's test function
- Verify SSL handshake succeeds
- Check authentication passes
- Confirm redirect to storefront works

#### 2. Shopping Flow Test
- Browse catalog in PunchOut mode
- Verify pricing displays correctly
- Add multiple items to cart
- Check quantities and totals

#### 3. Return Test  
- Click "Return to Procurement" 
- Verify cart items transfer correctly
- Check all required fields populated
- Confirm requisition/PR creates successfully

#### 4. Edge Case Testing
- Empty cart return
- Large quantity orders
- Special characters in product names
- Network timeout scenarios

### Production Validation

#### 1. Pilot User Testing
- Select small group of test users
- Monitor for any issues
- Collect feedback on user experience
- Validate performance under load

#### 2. Full Rollout
- Communicate go-live to all users
- Monitor system performance
- Track conversion rates
- Address any support issues quickly

---

## Troubleshooting

### Common Issues

#### Authentication Failures
**Symptoms**: Setup request rejected, 401/403 errors
**Solutions**:
- Verify shared secret matches exactly
- Check identity domains are correct
- Ensure SSL certificate is valid
- Confirm no extra whitespace in credentials

#### Session Issues  
**Symptoms**: "Invalid session" errors, cart doesn't persist
**Solutions**:
- Check session hasn't expired (60 min default)
- Verify browser cookies enabled
- Clear browser cache and retry
- Check for JavaScript errors in console

#### Cart Return Failures
**Symptoms**: Items don't return to procurement system
**Solutions**:  
- Test return URL accessibility from supplier
- Verify XML/form format matches spec
- Check for network timeouts
- Review field mapping configuration

#### Pricing Issues
**Symptoms**: Wrong prices, missing discounts
**Solutions**:
- Verify price list assignment
- Check catalog scope configuration  
- Confirm currency settings match
- Review contract pricing setup

### Support Escalation

#### Level 1: Buyer Internal IT
- Basic connectivity testing
- User account verification
- Browser/system checks

#### Level 2: Supplier Support  
- Email: support@yourcompany.com
- Phone: 1-555-SUPPORT
- Include: Buyer ID, error messages, timestamp

#### Level 3: Technical Integration
- Email: integration@yourcompany.com  
- Provide: Full error logs, XML payloads
- Schedule: Screen sharing session if needed

---

## Best Practices

### For Buyers
- **Test Thoroughly**: Always test in non-production first
- **Plan Training**: Train users on new PunchOut workflow  
- **Monitor Usage**: Track adoption and performance metrics
- **Keep Updated**: Stay current with system updates

### For Suppliers
- **Document Everything**: Keep detailed buyer configurations
- **Monitor Performance**: Watch for slow response times
- **Update Regularly**: Keep catalogs and pricing current
- **Provide Support**: Responsive customer service is key

### Security Best Practices
- **Rotate Secrets**: Change shared secrets periodically
- **Monitor Access**: Watch for unusual activity patterns
- **Use HTTPS**: Always encrypt data in transit
- **Audit Regularly**: Review configurations quarterly

---

## Appendix

### Sample XML Payloads

#### Setup Request (Coupa)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE cXML SYSTEM "http://xml.cxml.org/schemas/cXML/1.2.014/cXML.dtd">
<cXML payloadID="1234567890" timestamp="2024-01-15T10:30:00Z">
  <Header>
    <From>
      <Credential domain="buyer.coupa.com">
        <Identity>acme-corp</Identity>
      </Credential>
    </From>
    <To>
      <Credential domain="yourstore.wix.com">
        <Identity>your-supplier-id</Identity>
      </Credential>
    </To>
    <Sender>
      <Credential domain="buyer.coupa.com">
        <Identity>coupa-sender</Identity>
        <SharedSecret>shared-secret-here</SharedSecret>
      </Credential>
    </Sender>
  </Header>
  <Request>
    <PunchOutSetupRequest operation="create">
      <BuyerCookie>user-session-12345</BuyerCookie>
    </PunchOutSetupRequest>
  </Request>
</cXML>
```

### Contact Information

**Technical Support**
- Email: support@yourcompany.com
- Phone: +1-555-TECH-HELP
- Hours: 8 AM - 6 PM EST, Monday-Friday

**Emergency Support**  
- Phone: +1-555-EMERGENCY
- Available: 24/7 for critical production issues

**Documentation Updates**
This guide is updated quarterly. Latest version available at:
https://yourcompany.com/punchout-documentation